{"version":3,"file":"static/webpack/static/development/pages/_app.js.f2aa0baa8db2e7db0d88.hot-update.js","sources":["webpack:///./pages/_app.js"],"sourcesContent":["import React from 'react'\nimport Header from '../components/header'\nimport App, { Container } from 'next/app'\nimport fetch from 'isomorphic-unfetch'\nimport _Cookies from 'easy-cookie-manager'\n\nimport '../components/shared.css'\n\nclass MyApp extends App {\n  constructor() {\n    super()\n    this.state = {\n      userToken: '',\n      isLoggedIn: false,\n      userData: {},\n      loginErrorMessage: ''\n    }\n    this.getLogin = this.getLogin.bind(this)\n    this.logout = this.logout.bind(this)\n    this.checkTokenFromCookie = this.checkTokenFromCookie.bind(this)\n  }\n  static async getInitialProps({ Component, ctx }) {\n    let pageProps = {}\n\n    if (Component.getInitialProps) {\n      pageProps = await Component.getInitialProps(ctx)\n    }\n    const res = await fetch(\n      'https://hpvtexas.wpengine.com/wp-json/better-rest-endpoints/v1/pages'\n    )\n    const menu = await fetch(\n      'https://hpvtexas.wpengine.com/wp-json/better-rest-endpoints/v1/menus/main'\n    )\n    const data = await res.json()\n    const menudata = await menu.json()\n\n    return { pageProps: pageProps, menudata: menudata }\n  }\n\n  async checkTokenFromCookie() {\n    let token = _Cookies.getCookie('hpv_usertoken39200')\n    if (token) {\n      const res = await fetch(\n        'https://hpvtexas.wpengine.com/wp-json/jwt-auth/v1/token/validate',\n        {\n          method: 'POST',\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }\n      )\n      const cleanRes = await res.json()\n      if (cleanRes.code == 'jwt_auth_valid_token') {\n        console.log(cleanRes)\n        this.setState({\n          userToken: token,\n          isLoggedIn: true\n        })\n\n        this.getUserInfo(token)\n      }\n    } else {\n      console.log('cookie not found with token')\n    }\n  }\n\n  componentDidMount() {\n    this.checkTokenFromCookie()\n  }\n\n  async getUserInfo(token) {\n    const rawResponse = await fetch(\n      'https://hpvtexas.wpengine.com/wp-json/wp/v2/users/me',\n      {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }\n    )\n    const res = await rawResponse.json()\n    console.log(res)\n    if (!res.data || !res.data.status) {\n      this.setState({\n        userData: res\n      })\n    }\n  }\n\n  async getLogin(user, pass) {\n    const rawResponse = await fetch(\n      'https://hpvtexas.wpengine.com/wp-json/jwt-auth/v1/token',\n      {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: user,\n          password: pass\n        })\n      }\n    )\n    const res = await rawResponse.json()\n    if (!res.data || !res.data.status) {\n      this.setState({\n        userToken: res.token,\n        isLoggedIn: true\n      })\n      _Cookies.setCookie('hpv_usertoken39200', res.token, 30)\n    } else if (res.message) {\n      console.log(res.message)\n      this.setState({\n        loginErrorMessage: res.message\n      })\n    }\n    console.log(res)\n  }\n\n  logout() {\n    this.setState({\n      userToken: '',\n      isLoggedIn: false\n    })\n    _Cookies.deleteCookie('hpv_usertoken39200')\n  }\n\n  render() {\n    const { Component, pageProps } = this.props\n    return (\n      <Container>\n        <Header menudata={this.props.menudata} />\n        <Component\n          {...pageProps}\n          getLogin={this.getLogin}\n          logout={this.logout}\n          loginData={{\n            isLoggedIn: this.state.isLoggedIn,\n            userToken: this.state.userToken,\n            loginErrorMessage: this.state.loginErrorMessage,\n            userData: this.state.userData\n          }}\n        />\n      </Container>\n    )\n  }\n}\n\nexport default MyApp\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAVA;AAWA;AACA;;;;;;;;;;;;AAmBA;AACA;AAAA;;;;;;AACA;AAGA;AACA;AACA;AADA;AAFA;AACA;;AAHA;;AASA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;;;;;AACA;AACA;;;;;;;;;;;;;;;;;AAGA;AACA;AACA;;;;;;AAEA;;;;;;;AACA;AAGA;AACA;AACA;AADA;AAFA;AACA;;AAHA;;AASA;AACA;;AADA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;AACA;AAGA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AANA;AACA;;AAHA;;AAcA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;;;;;;;;;;;;AA7HA;AACA;AACA;AACA;;;;;;AACA;AACA;;AADA;AACA;;;AACA;AACA;;AADA;;AAGA;AACA;;AADA;;AAGA;AACA;;AADA;;AACA;AACA;;AADA;AAEA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;AA7BA;AACA;AA4IA;;;;A","sourceRoot":""}