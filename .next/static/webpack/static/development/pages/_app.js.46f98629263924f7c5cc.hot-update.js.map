{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.46f98629263924f7c5cc.hot-update.js","sources":["webpack:///./pages/_app.js"],"sourcesContent":["import React from 'react'\r\nimport Header from '../components/header'\r\nimport App, { Container } from 'next/app'\r\nimport fetch from 'isomorphic-unfetch'\r\nimport _Cookies from 'easy-cookie-manager'\r\n\r\nimport '../components/shared.css'\r\n\r\nclass MyApp extends App {\r\n  constructor() {\r\n    super()\r\n    this.state = {\r\n      userToken: '',\r\n      isLoggedIn: false,\r\n      userData: {},\r\n      loginErrorMessage: ''\r\n    }\r\n    this.getLogin = this.getLogin.bind(this)\r\n    this.logout = this.logout.bind(this)\r\n    this.checkTokenFromCookie = this.checkTokenFromCookie.bind(this)\r\n  }\r\n  static async getInitialProps({ Component, ctx }) {\r\n    let pageProps = {}\r\n\r\n    if (Component.getInitialProps) {\r\n      pageProps = await Component.getInitialProps(ctx)\r\n    }\r\n    const res = await fetch(\r\n      'https://hpvtexas.wpengine.com/wp-json/better-rest-endpoints/v1/pages'\r\n    )\r\n    const menu = await fetch(\r\n      'https://hpvtexas.wpengine.com/wp-json/better-rest-endpoints/v1/menus/main'\r\n    )\r\n    const data = await res.json()\r\n    const menudata = await menu.json()\r\n\r\n    return { pageProps: pageProps, menudata: menudata }\r\n  }\r\n\r\n  async checkTokenFromCookie() {\r\n    let token = _Cookies.getCookie('hpv_usertoken39200')\r\n    if (token) {\r\n      const res = await fetch(\r\n        'https://hpvtexas.wpengine.com/wp-json/jwt-auth/v1/token/validate',\r\n        {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Bearer ${token}`\r\n          }\r\n        }\r\n      )\r\n      const cleanRes = await res.json()\r\n      if (cleanRes.code == 'jwt_auth_valid_token') {\r\n        console.log(cleanRes)\r\n        this.setState({\r\n          userToken: token,\r\n          isLoggedIn: true\r\n        })\r\n\r\n        this.getUserInfo(token)\r\n      }\r\n    } else {\r\n      console.log('cookie not found with token')\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.checkTokenFromCookie()\r\n  }\r\n\r\n  async getUserInfo(token) {\r\n    const rawResponse = await fetch(\r\n      'https://hpvtexas.wpengine.com/wp-json/wp/v2/users/me',\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          Authorization: `Bearer ${token}`\r\n        }\r\n      }\r\n    )\r\n    const res = await rawResponse.json()\r\n    console.log(res)\r\n    if (!res.data || !res.data.status) {\r\n      this.setState({\r\n        userData: res\r\n      })\r\n    }\r\n  }\r\n\r\n  async getLogin(user, pass) {\r\n    const rawResponse = await fetch(\r\n      'https://hpvtexas.wpengine.com/wp-json/jwt-auth/v1/token',\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          Accept: 'application/json',\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          username: user,\r\n          password: pass\r\n        })\r\n      }\r\n    )\r\n    const res = await rawResponse.json()\r\n    if (!res.data || !res.data.status) {\r\n      this.setState({\r\n        userToken: res.token,\r\n        isLoggedIn: true\r\n      })\r\n      _Cookies.setCookie('hpv_usertoken39200', res.token, 30)\r\n    } else if (res.message) {\r\n      console.log(res.message)\r\n      this.setState({\r\n        loginErrorMessage: res.message\r\n      })\r\n    }\r\n    console.log(res)\r\n  }\r\n\r\n  logout() {\r\n    console.log('logging out')\r\n    this.setState({\r\n      userToken: '',\r\n      isLoggedIn: false\r\n    })\r\n    _Cookies.deleteCookie('hpv_usertoken39200')\r\n    console.log('logged out')\r\n  }\r\n\r\n  render() {\r\n    const { Component, pageProps } = this.props\r\n    return (\r\n      <Container>\r\n        <Header menudata={this.props.menudata} />\r\n        <Component\r\n          {...pageProps}\r\n          getLogin={this.getLogin}\r\n          logout={this.logout}\r\n          loginData={{\r\n            isLoggedIn: this.state.isLoggedIn,\r\n            userToken: this.state.userToken,\r\n            loginErrorMessage: this.state.loginErrorMessage,\r\n            userData: this.state.userData\r\n          }}\r\n        />\r\n      </Container>\r\n    )\r\n  }\r\n}\r\n\r\nexport default MyApp\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAVA;AAWA;AACA;;;;;;;;;;;;AAmBA;AACA;AAAA;;;;;;AACA;AAGA;AACA;AACA;AADA;AAFA;AACA;;AAHA;;AASA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;;;;;AACA;AACA;;;;;;;;;;;;;;;;;AAGA;AACA;AACA;;;;;;AAEA;;;;;;;AACA;AAGA;AACA;AACA;AADA;AAFA;AACA;;AAHA;;AASA;AACA;;AADA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;AACA;AAGA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AANA;AACA;;AAHA;;AAcA;AACA;;AADA;AACA;AAAA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;;;;;;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;;;;;;;;;;;;AA/HA;AACA;AACA;AACA;;;;;;AACA;AACA;;AADA;AACA;;;AACA;AACA;;AADA;;AAGA;AACA;;AADA;;AAGA;AACA;;AADA;;AACA;AACA;;AADA;AAEA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;AA7BA;AACA;AA8IA;;;;A","sourceRoot":""}